<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Home Page</title>
    <link th:href="@{/homepage_stylesheet.css}" rel="stylesheet">
</head>
<body>
<h1>Themen</h1>
<div class = "container">
    <a th:href="@{/createfrage}">Neue Frage Erstellen</a>
    <table id="table">
        <tr>
            <th>Title</th>
            <th>Status</th>
            <th>Action</th>
        </tr>
        <tr th:each="frage: ${fragen}">
            <td>
                <a th:href="${frage.isActive && !votedFragen.contains(frage)} ? @{/frage (frageId = ${frage.id})} : '#'"
                   th:text="${frage.title}">Link</a>
            </td>
            <td th:text ="${frage.isActive} ? 'Active' : 'Closed'"></td>
            <td th:if="${frage.user.id} == ${userId} and ${frage.isActive}">
                <button th:attr="onclick='endRating(' + ${frage.id} + ');'" th:text="'End Rating'">End Rating</button>
            </td>


            <td th:if="${!frage.isActive}">
                <a th:href="@{/auswertung (frageId = ${frage.id})}">Auswertung anzeigen</a>
            </td>


        </tr>

    </table>
</div>
</body>
</html>
<script>

    function endRating(frageId) {
        var confirmEnd = confirm("Are you sure you want to end the rating?");
        if (confirmEnd == true) {
            fetch('/endRating/' + frageId, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
                .then(() => {
                    location.reload();
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
        }
    }



</script>
